// Protocol Buffers - Google's data interchange format
// Copyright 2015 Google Inc.  All rights reserved.
//
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file or at
// https://developers.google.com/open-source/licenses/bsd

// Cycles in the Message graph can cause problems for message class
// initialization order, particularly with the parsing constructor feature.
//
// This proto is designed to test circular dependencies that could trigger
// deadlocks during static initialization if parsers are eagerly initialized.

syntax = "proto2";

package protobuf_unittest;

option java_package = "com.google.protobuf";
option java_outer_classname = "UnittestCycle";

// Circular dependency pattern: Foo -> Bar -> Baz -> Foo
// This tests the lazy parser initialization fix.

message Foo {
  optional int32 id = 1;
  optional Foo a_foo = 2;  // Self-reference
  optional Bar a_bar = 3;  // Cross-reference to Bar
  optional Baz a_baz = 4;  // Cross-reference to Baz
}

message Bar {
  optional int32 id = 1;
  optional Bar a_bar = 2;  // Self-reference
  optional Baz a_baz = 3;  // Cross-reference to Baz
  optional Foo a_foo = 4;  // Cross-reference back to Foo (completes cycle)
}

message Baz {
  optional int32 id = 1;
  optional Baz a_baz = 2;  // Self-reference
  optional Foo a_foo = 3;  // Cross-reference to Foo
  optional Bar a_bar = 4;  // Cross-reference to Bar
}
